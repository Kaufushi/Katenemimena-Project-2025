<!DOCTYPE html>
<html lang="en"
      xmlns:th="http://www.thymeleaf.org">
<head>
    <meta charset="UTF-8">
    <meta name="viewport" content="width=device-width, initial-scale=1.0">
    <title>My Orders - StreetFoodGo</title>
    <link href="https://fonts.googleapis.com/css2?family=Poppins:wght@400;600;700&display=swap" rel="stylesheet">
    <link rel="stylesheet" href="https://cdn.jsdelivr.net/npm/bootstrap-icons@1.10.0/font/bootstrap-icons.css">
    <link rel="stylesheet" th:href="@{/css/orders.css}">
</head>
<body>

<nav class="navbar">
    <div class="container">
        <a class="logo" href="/">
            <i class="bi bi-shop logo-icon"></i>
            <span class="logo-text">StreetFoodGo</span>
        </a>
        <a class="nav-link" href="/">
            <i class="bi bi-house"></i> Home
        </a>
    </div>
</nav>

<div class="content">
    <div class="container">

        <div class="page-header">
            <h2><i class="bi bi-bag-check"></i> My Orders</h2>
            <p>View all your order history</p>
        </div>

        <div th:if="${error}" class="alert alert-danger">
            <i class="bi bi-exclamation-triangle"></i>
            <span th:text="${error}"></span>
            <button type="button" class="btn-close" onclick="this.parentElement.style.display='none'">×</button>
        </div>

        <div th:if="${success}" class="alert alert-success">
            <i class="bi bi-check-circle"></i>
            <span th:text="${success}"></span>
            <button type="button" class="btn-close" onclick="this.parentElement.style.display='none'">×</button>
        </div>

        <div class="filter-buttons">
            <button type="button" class="filter-btn active" onclick="filterOrders('all')">All Orders</button>
            <button type="button" class="filter-btn" onclick="filterOrders('pending')">Pending</button>
            <button type="button" class="filter-btn" onclick="filterOrders('preparing')">Preparing</button>
            <button type="button" class="filter-btn" onclick="filterOrders('in_delivery')">In Delivery</button>
            <button type="button" class="filter-btn" onclick="filterOrders('completed')">Completed</button>
            <button type="button" class="filter-btn" onclick="filterOrders('cancelled')">Cancelled</button>
        </div>

        <div th:if="${orders.isEmpty()}" class="empty-state">
            <i class="bi bi-inbox"></i>
            <p>You haven't placed any orders yet. Start exploring restaurants!</p>
        </div>

        <div class="orders-grid">

            <!-- NON-COMPLETED ORDERS -->
            <div th:each="order : ${orders}"
                 th:if="${order.status.name() != 'COMPLETED'}"
                 class="order-card order-filter"
                 th:classappend="${order.status.name().toLowerCase()}"
                 th:data-status="${order.status.name().toLowerCase()}">

                <div class="restaurant-badge">
                    <div class="restaurant-badge-content">
                        <div>
                            <i class="bi bi-shop"></i>
                            <strong class="restaurant-name" th:text="${order.restaurant.name}"></strong>
                        </div>
                        <small class="order-number">
                            Order #<span th:text="${order.id}"></span>
                        </small>
                    </div>
                </div>

                <div class="order-details">
                    <div>
                        <span th:if="${order.status.name() == 'PENDING'}" class="status-badge badge-pending">Pending</span>
                        <span th:if="${order.status.name() == 'PREPARING'}" class="status-badge badge-preparing">Preparing</span>
                        <span th:if="${order.status.name() == 'IN_DELIVERY'}" class="status-badge badge-in_delivery">In Delivery</span>
                        <span th:if="${order.status.name() == 'CANCELLED'}" class="status-badge badge-cancelled">Cancelled</span>

                        <div class="order-time">
                            <i class="bi bi-clock"></i>
                            <span th:text="${#temporals.format(order.createdAt, 'dd/MM/yyyy HH:mm')}"></span>
                        </div>
                    </div>

                    <div class="order-total">
                        <div class="total-price">
                            €<span th:text="${#numbers.formatDecimal(order.totalPrice, 1, 2)}"></span>
                        </div>
                    </div>
                </div>

                <div class="order-items">
                    <h6>Order Items:</h6>
                    <div th:each="item : ${order.orderItems}" class="order-item">
                        <div>
                            <span class="item-name" th:text="${item.menuItem.name}"></span>
                            <span class="item-quantity">x<span th:text="${item.quantity}"></span></span>
                        </div>
                        <span class="item-price">
                            €<span th:text="${#numbers.formatDecimal(item.price * item.quantity, 1, 2)}"></span>
                        </span>
                    </div>
                </div>
            </div>

            <!-- COMPLETED ORDERS (WITH ITEMS) -->
            <div th:each="order : ${orders}"
                 th:if="${order.status.name() == 'COMPLETED'}"
                 class="order-card order-filter completed"
                 data-status="completed">

                <div class="restaurant-badge">
                    <div class="restaurant-badge-content">
                        <div>
                            <i class="bi bi-shop"></i>
                            <strong class="restaurant-name" th:text="${order.restaurant.name}"></strong>
                        </div>
                        <small class="order-number">
                            Order #<span th:text="${order.id}"></span>
                        </small>
                    </div>
                </div>

                <div class="order-details">
                    <div>
                        <span class="status-badge badge-completed">Completed</span>
                        <div class="order-time">
                            <i class="bi bi-clock"></i>
                            <span th:text="${#temporals.format(order.createdAt, 'dd/MM/yyyy HH:mm')}"></span>
                        </div>
                    </div>

                    <div class="order-total">
                        <div class="total-price">
                            €<span th:text="${#numbers.formatDecimal(order.totalPrice, 1, 2)}"></span>
                        </div>
                    </div>
                </div>

                <!-- ✅ RESTORED ITEMS -->
                <div class="order-items">
                    <h6>Order Items:</h6>
                    <div th:each="item : ${order.orderItems}" class="order-item">
                        <div>
                            <span class="item-name" th:text="${item.menuItem.name}"></span>
                            <span class="item-quantity">x<span th:text="${item.quantity}"></span></span>
                        </div>
                        <span class="item-price">
                            €<span th:text="${#numbers.formatDecimal(item.price * item.quantity, 1, 2)}"></span>
                        </span>
                    </div>
                </div>

                <div class="status-message completed">
                    <i class="bi bi-check-circle"></i>
                    <span>Order delivered! Hope you enjoyed your meal!</span>
                </div>
            </div>

        </div>
    </div>
</div>

<script>
    function filterOrders(status) {
        const allOrders = document.querySelectorAll('.order-filter');
        const buttons = document.querySelectorAll('.filter-btn');

        buttons.forEach(btn => btn.classList.remove('active'));
        event.target.classList.add('active');

        if (status === 'all') {
            allOrders.forEach(order => order.style.display = 'block');
        } else {
            allOrders.forEach(order => {
                order.style.display = order.classList.contains(status) ? 'block' : 'none';
            });
        }
    }
</script>

</body>
</html>
