<!DOCTYPE html>
<html lang="en"
      xmlns:th="http://www.thymeleaf.org">
<head>
    <meta charset="UTF-8">
    <meta name="viewport" content="width=device-width, initial-scale=1.0">
    <title th:text="'Orders - ' + ${restaurant.name}">Orders</title>
    <link href="https://fonts.googleapis.com/css2?family=Poppins:wght@400;600;700&display=swap" rel="stylesheet">
    <link rel="stylesheet" href="https://cdn.jsdelivr.net/npm/bootstrap-icons@1.10.0/font/bootstrap-icons.css">
    <link rel="stylesheet" th:href="@{/css/orders.css}">

</head>
<body>
<nav class="navbar">
    <div class="container">
        <a class="logo" href="/">
            <i class="bi bi-shop logo-icon"></i>
            <span class="logo-text">StreetFoodGo</span>
        </a>
        <a class="nav-link" th:href="@{/owner/restaurants/{id}/manage(id=${restaurant.id})}">
            <i class="bi bi-arrow-left"></i> Back to Restaurant
        </a>
    </div>
</nav>

<div class="content">
    <div class="container">
        <!-- Header -->
        <div class="page-header">
            <h2>
                <i class="bi bi-receipt"></i> Orders for <span th:text="${restaurant.name}">Restaurant</span>
            </h2>
            <p>Manage all orders for your restaurant</p>
        </div>

        <!-- Alert Messages -->
        <div th:if="${error}" class="alert alert-danger">
            <i class="bi bi-exclamation-triangle"></i>
            <span th:text="${error}"></span>
            <button type="button" class="btn-close" onclick="this.parentElement.style.display='none'">×</button>
        </div>
        <div th:if="${success}" class="alert alert-success">
            <i class="bi bi-check-circle"></i>
            <span th:text="${success}"></span>
            <button type="button" class="btn-close" onclick="this.parentElement.style.display='none'">×</button>
        </div>

        <!-- Filter Buttons -->
        <div class="filter-buttons">
            <button type="button" class="filter-btn active" onclick="filterOrders('all')">
                All Orders
            </button>
            <button type="button" class="filter-btn" onclick="filterOrders('pending')">
                Pending
            </button>
            <button type="button" class="filter-btn" onclick="filterOrders('preparing')">
                Preparing
            </button>
            <button type="button" class="filter-btn" onclick="filterOrders('in_delivery')">
                In Delivery
            </button>
            <button type="button" class="filter-btn" onclick="filterOrders('completed')">
                Completed
            </button>
            <button type="button" class="filter-btn" onclick="filterOrders('cancelled')">
                Cancelled
            </button>
        </div>

        <!-- Orders List -->
        <div th:if="${orders.isEmpty()}" class="empty-state">
            <i class="bi bi-inbox"></i>
            <p>No orders found for this restaurant yet.</p>
        </div>

        <div class="orders-grid">
            <div th:each="order : ${orders}"
                 class="order-card order-filter"
                 th:classappend="${order.status.name().toLowerCase()}"
                 th:data-status="${order.status.name().toLowerCase()}">

                <!-- Restaurant Info -->
                <div class="restaurant-badge">
                    <div class="restaurant-badge-content">
                        <div>
                            <strong class="restaurant-name">Order #<span th:text="${order.id}">123</span></strong>
                        </div>
                        <span th:if="${order.status.name() == 'PENDING'}" class="status-badge badge-pending">Pending</span>
                        <span th:if="${order.status.name() == 'PREPARING'}" class="status-badge badge-preparing">Preparing</span>
                        <span th:if="${order.status.name() == 'IN_DELIVERY'}" class="status-badge badge-in_delivery">In Delivery</span>
                        <span th:if="${order.status.name() == 'COMPLETED'}" class="status-badge badge-completed">Completed</span>
                        <span th:if="${order.status.name() == 'CANCELLED'}" class="status-badge badge-cancelled">Cancelled</span>
                    </div>
                </div>

                <!-- Order Details -->
                <div class="order-details">
                    <div>
                        <p class="customer-info">
                            <i class="bi bi-person"></i>
                            <strong>Customer:</strong>
                            <span th:text="${order.customer != null ? (order.customer.firstname != null && order.customer.lastname != null ? order.customer.firstname + ' ' + order.customer.lastname : order.customer.username) : 'Unknown'}">John Doe</span>
                        </p>
                        <div class="order-time">
                            <i class="bi bi-clock"></i>
                            <span th:text="${#temporals.format(order.createdAt, 'dd/MM/yyyy HH:mm')}">01/01/2024 12:00</span>
                        </div>
                    </div>

                    <div class="order-total">
                        <div class="total-price">
                            €<span th:text="${#numbers.formatDecimal(order.totalPrice, 1, 2)}">0.00</span>
                        </div>

                        <!-- Status Update Form -->
                        <form th:action="@{/owner/restaurants/{restaurantId}/orders/{orderId}/status(restaurantId=${restaurant.id}, orderId=${order.id})}"
                              method="post" class="status-update-form">
                            <select name="status" class="form-select-sm" required>
                                <option value="">Update Status</option>
                                <option value="PENDING" th:selected="${order.status.name() == 'PENDING'}">Pending</option>
                                <option value="PREPARING" th:selected="${order.status.name() == 'PREPARING'}">Preparing</option>
                                <option value="IN_DELIVERY" th:selected="${order.status.name() == 'IN_DELIVERY'}">In Delivery</option>
                                <option value="COMPLETED" th:selected="${order.status.name() == 'COMPLETED'}">Completed</option>
                                <option value="CANCELLED" th:selected="${order.status.name() == 'CANCELLED'}">Cancelled</option>
                            </select>
                            <button type="submit" class="btn-update">
                                <i class="bi bi-arrow-repeat"></i> Update Status
                            </button>
                        </form>
                    </div>
                </div>

                <!-- Order Items -->
                <div class="order-items">
                    <h6>Order Items:</h6>
                    <div th:each="item : ${order.orderItems}" class="order-item">
                        <div>
                            <span class="item-name" th:text="${item.menuItem.name}">Item Name</span>
                            <span class="item-quantity">x<span th:text="${item.quantity}">1</span></span>
                        </div>
                        <span class="item-price">
                            €<span th:text="${#numbers.formatDecimal(item.price * item.quantity, 1, 2)}">0.00</span>
                        </span>
                    </div>
                </div>

                <!-- Customer Contact -->
                <div th:if="${order.customer != null && order.customer.emailAddress != null}" class="customer-contact">
                    <i class="bi bi-envelope"></i>
                    <span th:text="${order.customer.emailAddress}">customer@email.com</span>
                </div>
            </div>
        </div>
    </div>
</div>

<script>
    function filterOrders(status) {
        const allOrders = document.querySelectorAll('.order-filter');
        const buttons = document.querySelectorAll('.filter-btn');

        // Update button states
        buttons.forEach(btn => btn.classList.remove('active'));
        event.target.classList.add('active');

        // Filter orders
        if (status === 'all') {
            allOrders.forEach(order => order.style.display = 'block');
        } else {
            allOrders.forEach(order => {
                if (order.classList.contains(status)) {
                    order.style.display = 'block';
                } else {
                    order.style.display = 'none';
                }
            });
        }
    }
</script>
</body>
</html>